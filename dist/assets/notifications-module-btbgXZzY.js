import{r as o,j as e,Z as c,x,v as E,B as S}from"./index-BAZ5r3BO.js";import{C as k,d as A}from"./Card-DsCaw10F.js";import{S as C}from"./skeleton-BBn7ZAan.js";import{u as j}from"./use-toast-BUI7Dgf-.js";const T={info:e.jsx(c,{className:"h-5 w-5 text-blue-500"}),warning:e.jsx(c,{className:"h-5 w-5 text-orange-500"}),success:e.jsx(c,{className:"h-5 w-5 text-green-500"}),action_required:e.jsx(c,{className:"h-5 w-5 text-indigo-500"})},q={info:"bg-blue-50 border-blue-200 dark:bg-blue-950 dark:border-blue-800",warning:"bg-orange-50 border-orange-200 dark:bg-orange-950 dark:border-orange-800",success:"bg-green-50 border-green-200 dark:bg-green-950 dark:border-green-800",action_required:"bg-indigo-50 border-indigo-200 dark:bg-indigo-950 dark:border-indigo-800"},D=({notification:s,clientName:n,setActiveTab:g})=>{const{toast:u}=j(),[m,d]=o.useState(!1),l=async()=>{try{d(!0);const{error:r}=await x.from("notifications").update({status:"read",updatedAt:new Date().toISOString()}).eq("id",s.id);if(r)throw r;s.status="read"}catch(r){u({title:"Error",description:(r==null?void 0:r.message)||"No se pudo marcar como leída",variant:"destructive"})}finally{d(!1)}};return e.jsx(k,{className:E(s.status==="unread"?"bg-background":"bg-muted/50 dark:bg-muted/20",q[s.type]),children:e.jsxs(A,{className:"p-4 flex items-start gap-4",children:[e.jsx("div",{className:"pt-1",children:T[s.type]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"text-sm text-foreground mb-1",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Sujeto: ",e.jsx("span",{className:"font-medium text-foreground/80",children:n})," | ",new Date(s.createdAt).toLocaleString("es-VE")]})]}),s.status==="unread"&&e.jsx(S,{variant:"ghost",size:"sm",onClick:l,disabled:m,children:"Marcar como leída"})]})})};function _({setActiveTab:s}){const[n,g]=o.useState([]),[u,m]=o.useState({}),[d,l]=o.useState(!0),[r,N]=o.useState(null),{toast:f}=j();o.useEffect(()=>{(async()=>{try{l(!0);const{data:t,error:i}=await x.from("bolivarDigitalClients").select("*");if(i)throw i;const v=(t==null?void 0:t.reduce((y,p)=>({...y,[p.id]:p}),{}))||{};m(v);const{data:w,error:h}=await x.from("notifications").select("*").order("createdAt",{ascending:!1});if(h)throw h;g(w||[])}catch(t){console.error("Error fetching data:",t),N(t instanceof Error?t:new Error("Error al cargar las notificaciones")),f({title:"Error",description:"No se pudieron cargar las notificaciones",variant:"destructive"})}finally{l(!1)}})()},[f]);const b=o.useMemo(()=>n.filter(a=>a.status==="unread").length,[n]);return e.jsxs("div",{className:"p-1 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-semibold text-foreground",children:"Centro de Notificaciones"}),b>0&&e.jsxs("span",{className:"inline-flex items-center rounded px-2 py-1 text-xs font-medium bg-destructive/15 text-destructive border border-destructive/30",children:[b," Sin Leer"]})]}),d?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((a,t)=>e.jsx(C,{className:"h-20 w-full"},t))}):r?e.jsxs("p",{className:"text-destructive",children:["Error: ",r.message]}):n.length===0?e.jsxs("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:[e.jsx(c,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-foreground",children:"Bandeja de entrada vacía"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Las alertas y acciones requeridas aparecerán aquí."})]}):e.jsx("div",{className:"space-y-3",children:n.map(a=>{var i;const t=((i=u[a.clientId])==null?void 0:i.fullName)||"Sujeto no encontrado";return e.jsx(D,{notification:a,clientName:t,setActiveTab},a.id)})})]})}export{_ as default};
//# sourceMappingURL=notifications-module-btbgXZzY.js.map
