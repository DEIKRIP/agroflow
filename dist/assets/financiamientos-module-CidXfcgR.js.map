{"version":3,"file":"financiamientos-module-CidXfcgR.js","sources":["../../src/features/financing/bolivar-digital/generate-schedule-dialog.tsx","../../src/features/financing/bolivar-digital/financiamientos-module.tsx"],"sourcesContent":["\n\"use client\";\n\nimport { useActionState, useEffect, useRef, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  generateScheduleAction,\n  type FormActionState,\n} from \"@/lib/bolivarDigitalActions\";\nimport Button from \"@/components/ui/Button\";\nimport {\n  Dialog,\n  Content as DialogContent,\n  Description as DialogDescription,\n  Header as DialogHeader,\n  Title as DialogTitle,\n  Trigger as DialogTrigger,\n  Footer as DialogFooter,\n  Close as DialogClose,\n} from \"@/components/ui/Dialog\";\nimport Input from \"@/components/ui/Input\";\nimport { Label } from \"@/components/ui/Label\";\nimport Select from \"@/components/ui/Select\";\nimport type { Financiamiento } from \"@/lib/types\";\n\ntype GenerateScheduleDialogProps = { financiamiento: Financiamiento };\n\nexport default function GenerateScheduleDialog({ financiamiento }: GenerateScheduleDialogProps) {\n  const [open, setOpen] = useState(false);\n  const [state, formAction, isPending] = useActionState<FormActionState | null>(generateScheduleAction, null);\n  const { toast } = useToast();\n  const formRef = useRef<HTMLFormElement>(null);\n\n  useEffect(() => {\n    if (isPending || !state) return;\n    if (state.success) {\n      toast({ title: \"Éxito\", description: state.message || \"Cronograma generado\" });\n      setOpen(false);\n      formRef.current?.reset();\n    } else {\n      toast({ title: \"Error\", description: state.message || \"No se pudo generar\", variant: \"destructive\" });\n    }\n  }, [state, isPending, toast]);\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"secondary\">Generar Cronograma</Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Generar Cronograma</DialogTitle>\n          <DialogDescription>Configure los parámetros para el cronograma de pagos.</DialogDescription>\n        </DialogHeader>\n        <form ref={formRef} action={formAction} className=\"space-y-4\">\n          <input type=\"hidden\" name=\"financiamientoId\" value={String(financiamiento.id || \"\")} />\n          <div>\n            <Label htmlFor=\"harvestValue\">Valor esperado de cosecha (Bs.)</Label>\n            <Input id=\"harvestValue\" name=\"harvestValue\" type=\"number\" step=\"0.01\" required />\n            {state?.errors?.harvestValue && (\n              <p className=\"text-sm text-destructive mt-1\">{state.errors.harvestValue}</p>\n            )}\n          </div>\n          <div>\n            <Label htmlFor=\"frequency\">Frecuencia</Label>\n            <Select\n              id=\"frequency\"\n              name=\"frequency\"\n              required\n              options={[\n                { value: \"Mensual\", label: \"Mensual\" },\n                { value: \"Trimestral\", label: \"Trimestral\" },\n                { value: \"Al final\", label: \"Al final\" },\n              ]}\n              placeholder=\"Seleccione una frecuencia...\"\n            />\n            {state?.errors?.frequency && <p className=\"text-sm text-destructive mt-1\">{state.errors.frequency}</p>}\n          </div>\n          <DialogFooter>\n            <DialogClose asChild>\n              <Button type=\"button\" variant=\"secondary\">\n                Cancelar\n              </Button>\n            </DialogClose>\n            <Button type=\"submit\" disabled={isPending}>\n              {isPending ? \"Generando...\" : \"Generar\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport type React from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/Card\";\nimport Button from \"@/components/ui/Button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport Input from \"@/components/ui/Input\";\nimport { listActiveFinanciamientosWithClient } from \"@/lib/bolivarDigitalActions\";\nimport type { Financiamiento } from \"@/lib/types\";\nimport GenerateScheduleDialog from \"./generate-schedule-dialog\";\n\nexport default function FinanciamientosModule() {\n  const [loading, setLoading] = useState(true);\n  const [financiamientos, setFinanciamientos] = useState<(Financiamiento & { clientName?: string })[]>([]);\n  const [filter, setFilter] = useState(\"\");\n\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      try {\n        const data = await listActiveFinanciamientosWithClient();\n        if (!cancelled) setFinanciamientos(data as any);\n      } catch (e) {\n        console.error(\"Error cargando financiamientos:\", e);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  const filtered = financiamientos.filter((f) => {\n    if (!filter.trim()) return true;\n    const name = (f.clientName || \"\").toLowerCase();\n    const proposito = (f.proposito || \"\").toLowerCase();\n    return name.includes(filter.toLowerCase()) || proposito.includes(filter.toLowerCase());\n  });\n\n  return (\n    <div className=\"p-2 space-y-4\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Financiamientos</CardTitle>\n          <CardDescription>Listado de créditos activos y en seguimiento.</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex gap-2\">\n            <Input\n              value={filter}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setFilter(e.target.value)}\n              placeholder=\"Filtrar por sujeto o propósito\"\n            />\n            <Button onClick={() => setFilter(\"\")} variant=\"secondary\">Limpiar</Button>\n          </div>\n\n          {loading && <div className=\"space-y-2\">{[...Array(5)].map((_, i) => <Skeleton key={i} className=\"h-12 w-full\" />)}</div>}\n\n          {!loading && filtered.length === 0 && (\n            <p className=\"text-sm text-muted-foreground\">No hay resultados.</p>\n          )}\n\n          {!loading && filtered.length > 0 && (\n            <div className=\"grid gap-3 md:grid-cols-2\">\n              {filtered.map((f) => (\n                <Card key={String(f.id)}>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-base\">{f.proposito || \"Sin propósito\"}</CardTitle>\n                    <CardDescription>Sujeto: {f.clientName || \"Desconocido\"}</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span>Monto: <strong>Bs. {(f.monto || 0).toLocaleString(\"es-VE\")}</strong></span>\n                      <span>Pagado: <strong className=\"text-green-600\">Bs. {(f.totalPagado || 0).toLocaleString(\"es-VE\")}</strong></span>\n                      <span className=\"text-muted-foreground\">{f.estado}</span>\n                    </div>\n                    <div className=\"mt-3\">\n                      <GenerateScheduleDialog financiamiento={f as Financiamiento} />\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}"],"names":["GenerateScheduleDialog","financiamiento","open","setOpen","useState","state","formAction","isPending","useActionState","generateScheduleAction","toast","useToast","formRef","useRef","useEffect","_a","jsxs","Dialog","jsx","DialogTrigger","Button","DialogContent","DialogHeader","DialogTitle","DialogDescription","Label","Input","Select","_b","DialogFooter","DialogClose","FinanciamientosModule","loading","setLoading","financiamientos","setFinanciamientos","filter","setFilter","cancelled","data","listActiveFinanciamientosWithClient","e","filtered","f","name","proposito","Card","CardHeader","CardTitle","CardDescription","CardContent","_","i","Skeleton"],"mappings":"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"}