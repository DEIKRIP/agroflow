import{r as o,j as e,D as ne,C as de,H as ce,T as ue,e as me,L as b,I as A,f as ge,F as pe,B as N,h as R,i as fe,k as xe,u as P,W as he,m as ve,n as je,o as Ne,p as be,q as ye,s as Ae,t as T,P as Ce,O as De,v as h,w,U as _,x as E,S as Se,A as we,y as Ee}from"./index-BAZ5r3BO.js";import{C as Re,a as Pe,b as Te,d as _e,e as Fe}from"./Card-DsCaw10F.js";import{u as D}from"./use-toast-BUI7Dgf-.js";import{s as Oe,d as $e}from"./bolivarDigitalActions-Dx5-RAqw.js";function Ie({isSubmitting:s,isEditing:r}){return e.jsx(N,{type:"submit",disabled:s,children:s?r?"Guardando...":"Registrando...":r?"Guardar Cambios":"Registrar Sujeto Productivo"})}function ke({isOpen:s,setIsOpen:r,onSuccess:a,client:t}){const[i,n]=o.useState({isSubmitting:!1,error:null,success:!1}),{toast:u}=D(),g=o.useRef(null),d=t!==null,m=async l=>{var f;try{n({isSubmitting:!0,error:null,success:!1});const p={id:t==null?void 0:t.id,fullName:l.get("fullName"),cedula:l.get("cedula"),rif:l.get("rif"),phone:l.get("phone"),address:l.get("address"),activity:l.get("activity")||"Producción Agrícola"},c=await Oe(p);if(c.success)u({title:"Éxito",description:c.message}),(f=g.current)==null||f.reset(),a&&a(),r(!1);else throw new Error(c.message)}catch(p){console.error("Error saving client:",p),u({title:"Error",description:p.message||"Ocurrió un error al guardar el cliente",variant:"destructive"}),n(c=>({...c,isSubmitting:!1,error:p.message}))}};return o.useEffect(()=>{var l;s||(n({isSubmitting:!1,error:null,success:!1}),(l=g.current)==null||l.reset())},[s]),e.jsx(ne,{open:s,onOpenChange:r,children:e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(ce,{children:[e.jsx(ue,{children:d?"Editar Sujeto Productivo":"Registrar Nuevo Sujeto Productivo"}),e.jsx(me,{children:d?"Modifique los datos del sujeto productivo.":"Complete los datos para registrar un nuevo sujeto productivo comunitario."})]}),e.jsxs("form",{ref:g,action:m,className:"space-y-4",children:[d&&e.jsx("input",{type:"hidden",name:"id",value:t==null?void 0:t.id}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"fullName",children:"Nombre Completo"}),e.jsx(A,{id:"fullName",name:"fullName",defaultValue:(t==null?void 0:t.fullName)??"",required:!0,autoComplete:"name",disabled:i.isSubmitting})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"cedula",children:"Cédula"}),e.jsx(A,{id:"cedula",name:"cedula",defaultValue:(t==null?void 0:t.cedula)??"",required:!0,disabled:i.isSubmitting})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"rif",children:"RIF"}),e.jsx(A,{id:"rif",name:"rif",defaultValue:(t==null?void 0:t.rif)??"",required:!0,disabled:i.isSubmitting})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"phone",children:"Teléfono"}),e.jsx(A,{id:"phone",name:"phone",type:"tel",defaultValue:(t==null?void 0:t.phone)??"",required:!0,autoComplete:"tel",disabled:i.isSubmitting})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"activity",children:"Actividad Productiva"}),e.jsx(A,{id:"activity",name:"activity",defaultValue:(t==null?void 0:t.activity)??"Producción Agrícola",required:!0,placeholder:"Ej: Productor de Maíz",disabled:i.isSubmitting})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"address",children:"Dirección"}),e.jsx(ge,{id:"address",name:"address",defaultValue:(t==null?void 0:t.address)??"",required:!0,autoComplete:"street-address",disabled:i.isSubmitting})]}),e.jsxs(pe,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:i.isSubmitting,children:"Cancelar"}),e.jsx(Ie,{isSubmitting:i.isSubmitting,isEditing:d})]})]})]})})}var F="AlertDialog",[Me,ts]=ve(F,[R]),v=R(),O=s=>{const{__scopeAlertDialog:r,...a}=s,t=v(r);return e.jsx(fe,{...t,...a,modal:!0})};O.displayName=F;var qe="AlertDialogTrigger",$=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,...t}=s,i=v(a);return e.jsx(xe,{...i,...t,ref:r})});$.displayName=qe;var ze="AlertDialogPortal",I=s=>{const{__scopeAlertDialog:r,...a}=s,t=v(r);return e.jsx(Ce,{...t,...a})};I.displayName=ze;var Le="AlertDialogOverlay",k=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,...t}=s,i=v(a);return e.jsx(De,{...i,...t,ref:r})});k.displayName=Le;var y="AlertDialogContent",[Ve,Ge]=Me(y),He=be("AlertDialogContent"),M=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,children:t,...i}=s,n=v(a),u=o.useRef(null),g=P(r,u),d=o.useRef(null);return e.jsx(he,{contentName:y,titleName:q,docsSlug:"alert-dialog",children:e.jsx(Ve,{scope:a,cancelRef:d,children:e.jsxs(je,{role:"alertdialog",...n,...i,ref:g,onOpenAutoFocus:Ne(i.onOpenAutoFocus,m=>{var l;m.preventDefault(),(l=d.current)==null||l.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[e.jsx(He,{children:t}),e.jsx(We,{contentRef:u})]})})})});M.displayName=y;var q="AlertDialogTitle",z=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,...t}=s,i=v(a);return e.jsx(ye,{...i,...t,ref:r})});z.displayName=q;var L="AlertDialogDescription",V=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,...t}=s,i=v(a);return e.jsx(Ae,{...i,...t,ref:r})});V.displayName=L;var Be="AlertDialogAction",G=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,...t}=s,i=v(a);return e.jsx(T,{...i,...t,ref:r})});G.displayName=Be;var H="AlertDialogCancel",B=o.forwardRef((s,r)=>{const{__scopeAlertDialog:a,...t}=s,{cancelRef:i}=Ge(H,a),n=v(a),u=P(r,i);return e.jsx(T,{...n,...t,ref:u})});B.displayName=H;var We=({contentRef:s})=>{const r=`\`${y}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${y}\` by passing a \`${L}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${y}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{var t;document.getElementById((t=s.current)==null?void 0:t.getAttribute("aria-describedby"))||console.warn(r)},[r,s]),null},Ue=O,Ye=$,W=I,U=k,Y=M,J=G,K=B,Q=z,X=V;const Je=Ue,Ke=Ye,Z=({className:s,children:r,...a})=>e.jsx(W,{className:h(s),...a,children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:r})});Z.displayName=W.displayName;const ee=o.forwardRef(({className:s,...r},a)=>e.jsx(U,{className:h("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",s),...r,ref:a}));ee.displayName=U.displayName;const se=o.forwardRef(({className:s,...r},a)=>e.jsxs(Z,{children:[e.jsx(ee,{}),e.jsx(Y,{ref:a,className:h("fixed z-50 grid w-full gap-4 rounded-t-lg border bg-background p-6 shadow-lg animate-in data-[state=open]:fade-in-90 data-[state=open]:slide-in-from-bottom-10 sm:max-w-lg sm:rounded-lg sm:zoom-in-90 data-[state=open]:sm:slide-in-from-bottom-0",s),...r})]}));se.displayName=Y.displayName;const te=({className:s,...r})=>e.jsx("div",{className:h("flex flex-col space-y-2 text-center sm:text-left",s),...r});te.displayName="AlertDialogHeader";const re=({className:s,...r})=>e.jsx("div",{className:h("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...r});re.displayName="AlertDialogFooter";const ae=o.forwardRef(({className:s,...r},a)=>e.jsx(Q,{ref:a,className:h("text-lg font-semibold",s),...r}));ae.displayName=Q.displayName;const ie=o.forwardRef(({className:s,...r},a)=>e.jsx(X,{ref:a,className:h("text-sm text-muted-foreground",s),...r}));ie.displayName=X.displayName;const oe=o.forwardRef(({className:s,...r},a)=>e.jsx(J,{ref:a,className:h("inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...r}));oe.displayName=J.displayName;const le=o.forwardRef(({className:s,...r},a)=>e.jsx(K,{ref:a,className:h("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 sm:mt-0",s),...r}));le.displayName=K.displayName;const Qe=({client:s,onEdit:r,onCreateFinanciamiento:a})=>{var p;const{toast:t}=D(),[i,n]=o.useState(!1),[u,g]=o.useState(!1),d=async()=>{n(!0);const c=await $e(s.id);c.success?t({title:"Éxito",description:c.message}):t({title:"Error",description:c.message,variant:"destructive"}),n(!1),g(!1)},m=()=>{a({clientId:s.id})},l=((p=s.historialParcelas)==null?void 0:p.reduce((c,C)=>c+C.montoTotalEstimado,0))??0,f=l>0;return e.jsxs(Re,{className:"flex flex-col",children:[e.jsxs(Pe,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(Te,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-primary"}),s.fullName]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>r(s),children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsxs(Je,{open:u,onOpenChange:g,children:[e.jsx(Ke,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:e.jsx(we,{className:"h-4 w-4"})})}),e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"¿Está seguro de eliminar?"}),e.jsx(ie,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente al sujeto productivo y todos sus datos asociados."})]}),e.jsxs(re,{children:[e.jsx(le,{children:"Cancelar"}),e.jsx(oe,{onClick:d,disabled:i,className:"bg-destructive hover:bg-destructive/90",children:i?"Eliminando...":"Sí, eliminar"})]})]})]})]})]}),e.jsxs(_e,{className:"text-sm text-muted-foreground space-y-2 flex-grow",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Cédula:"})," ",s.cedula]}),e.jsxs("p",{children:[e.jsx("strong",{children:"RIF:"})," ",s.rif]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Actividad:"})," ",s.activity]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dirección:"})," ",s.address]})]}),e.jsx(Fe,{children:e.jsx(N,{className:"w-full h-auto p-0",onClick:m,disabled:!f,variant:"secondary",children:e.jsxs("div",{className:"w-full p-3 bg-muted/50 rounded-md flex items-center justify-between text-foreground",children:[e.jsx("span",{className:"font-semibold flex items-center gap-2",children:"Total a Financiar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-lg",children:["Bs. ",l.toLocaleString("es-VE",{minimumFractionDigits:2})]}),f&&e.jsx(Ee,{className:"h-5 w-5 text-primary"})]})]})})})]})};function rs({onCreateFinanciamiento:s}){const[r,a]=o.useState([]),[t,i]=o.useState(!0),[n,u]=o.useState(null),[g,d]=o.useState(!1),[m,l]=o.useState(null),{toast:f}=D();o.useEffect(()=>{(async()=>{try{i(!0);const{data:j,error:S}=await E.from("bolivarDigitalClients").select("*");if(S)throw S;a(j||[])}catch(j){u(j),console.error("Error fetching clients:",j),f({title:"Error",description:"No se pudieron cargar los clientes",variant:"destructive"})}finally{i(!1)}})()},[]);const p=()=>{E.from("bolivarDigitalClients").select("*").then(({data:x,error:j})=>{if(j)throw j;a(x||[]),d(!1),l(null),f({title:"Cliente guardado exitosamente"})}).catch(x=>{console.error("Error reloading clients:",x),f({title:"Error",description:"No se pudo actualizar la lista de clientes",variant:"destructive"})})};if(t)return e.jsx("div",{children:"Cargando clientes..."});if(n)return e.jsxs("div",{children:["Error cargando clientes: ",n.message]});const c=()=>{l(null),d(!0)},C=x=>{l(x),d(!0)};return e.jsxs("div",{className:"p-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-semibold text-foreground",children:"Gestión de Sujetos Productivos"}),e.jsxs(N,{onClick:c,children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Añadir Sujeto Productivo"]})]}),t&&e.jsx("p",{children:"Cargando..."}),n&&e.jsxs("p",{className:"text-destructive",children:["Error: ",n.message]}),!t&&r.length===0?e.jsxs("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:[e.jsx(_,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-foreground",children:"No hay sujetos productivos registrados"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Empiece por añadir su primer sujeto productivo comunitario."}),e.jsx("div",{className:"mt-6",children:e.jsxs(N,{onClick:c,children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Añadir Sujeto Productivo"]})})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:r.map(x=>e.jsx(Qe,{client:x,onEdit:C,onCreateFinanciamiento:s},x.id))}),e.jsx(ke,{isOpen:g,setIsOpen:d,onSuccess:p,client:m})]})}export{rs as default};
//# sourceMappingURL=clients-module-CDQnbm5g.js.map
