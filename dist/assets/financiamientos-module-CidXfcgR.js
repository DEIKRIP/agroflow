import{r as t,j as e,D as y,z as N,B as m,C as S,H as b,T as F,e as L,L as h,I as C,E,F as w,G as V}from"./index-BAZ5r3BO.js";import{C as p,a as j,b as f,c as g,d as v}from"./Card-DsCaw10F.js";import{S as q}from"./skeleton-BBn7ZAan.js";import{g as A,l as T}from"./bolivarDigitalActions-Dx5-RAqw.js";import{u as D}from"./use-toast-BUI7Dgf-.js";function G({financiamiento:l}){var r,u;const[c,d]=t.useState(!1),[a,o,n]=t.useActionState(A,null),{toast:i}=D(),s=t.useRef(null);return t.useEffect(()=>{var x;n||!a||(a.success?(i({title:"Éxito",description:a.message||"Cronograma generado"}),d(!1),(x=s.current)==null||x.reset()):i({title:"Error",description:a.message||"No se pudo generar",variant:"destructive"}))},[a,n,i]),e.jsxs(y,{open:c,onOpenChange:d,children:[e.jsx(N,{asChild:!0,children:e.jsx(m,{variant:"secondary",children:"Generar Cronograma"})}),e.jsxs(S,{className:"sm:max-w-md",children:[e.jsxs(b,{children:[e.jsx(F,{children:"Generar Cronograma"}),e.jsx(L,{children:"Configure los parámetros para el cronograma de pagos."})]}),e.jsxs("form",{ref:s,action:o,className:"space-y-4",children:[e.jsx("input",{type:"hidden",name:"financiamientoId",value:String(l.id||"")}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"harvestValue",children:"Valor esperado de cosecha (Bs.)"}),e.jsx(C,{id:"harvestValue",name:"harvestValue",type:"number",step:"0.01",required:!0}),((r=a==null?void 0:a.errors)==null?void 0:r.harvestValue)&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:a.errors.harvestValue})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"frequency",children:"Frecuencia"}),e.jsx(E,{id:"frequency",name:"frequency",required:!0,options:[{value:"Mensual",label:"Mensual"},{value:"Trimestral",label:"Trimestral"},{value:"Al final",label:"Al final"}],placeholder:"Seleccione una frecuencia..."}),((u=a==null?void 0:a.errors)==null?void 0:u.frequency)&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:a.errors.frequency})]}),e.jsxs(w,{children:[e.jsx(V,{asChild:!0,children:e.jsx(m,{type:"button",variant:"secondary",children:"Cancelar"})}),e.jsx(m,{type:"submit",disabled:n,children:n?"Generando...":"Generar"})]})]})]})]})}function R(){const[l,c]=t.useState(!0),[d,a]=t.useState([]),[o,n]=t.useState("");t.useEffect(()=>{let s=!1;return(async()=>{c(!0);try{const r=await T();s||a(r)}catch(r){console.error("Error cargando financiamientos:",r)}finally{s||c(!1)}})(),()=>{s=!0}},[]);const i=d.filter(s=>{if(!o.trim())return!0;const r=(s.clientName||"").toLowerCase(),u=(s.proposito||"").toLowerCase();return r.includes(o.toLowerCase())||u.includes(o.toLowerCase())});return e.jsx("div",{className:"p-2 space-y-4",children:e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsx(f,{children:"Financiamientos"}),e.jsx(g,{children:"Listado de créditos activos y en seguimiento."})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:o,onChange:s=>n(s.target.value),placeholder:"Filtrar por sujeto o propósito"}),e.jsx(m,{onClick:()=>n(""),variant:"secondary",children:"Limpiar"})]}),l&&e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,r)=>e.jsx(q,{className:"h-12 w-full"},r))}),!l&&i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay resultados."}),!l&&i.length>0&&e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:i.map(s=>e.jsxs(p,{children:[e.jsxs(j,{className:"pb-2",children:[e.jsx(f,{className:"text-base",children:s.proposito||"Sin propósito"}),e.jsxs(g,{children:["Sujeto: ",s.clientName||"Desconocido"]})]}),e.jsxs(v,{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Monto: ",e.jsxs("strong",{children:["Bs. ",(s.monto||0).toLocaleString("es-VE")]})]}),e.jsxs("span",{children:["Pagado: ",e.jsxs("strong",{className:"text-green-600",children:["Bs. ",(s.totalPagado||0).toLocaleString("es-VE")]})]}),e.jsx("span",{className:"text-muted-foreground",children:s.estado})]}),e.jsx("div",{className:"mt-3",children:e.jsx(G,{financiamiento:s})})]})]},String(s.id)))})]})]})})}export{R as default};
//# sourceMappingURL=financiamientos-module-CidXfcgR.js.map
